<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bacteria Simulation</title>
<style>
body { font-family: Arial, sans-serif; display: flex; background:#f4f4f4; }
#sim { border: 1px solid #333; margin-right: 20px; background:#fff; }
#sidebar { width: 300px; }
#controls { margin-bottom:20px; }
#status { height:200px; overflow-y:auto; background:#222; color:#0f0; padding:5px; font-size:12px; }
</style>
</head>
<body>
<canvas id="sim" width="600" height="400"></canvas>
<div id="sidebar">
  <div id="controls">
    <h3>Parameters</h3>
    <label>Grass growth rate: <input type="range" id="growth" min="0" max="1" step="0.01" value="0.1"></label>
    <p>Herbivores: <span id="herbCount">0</span></p>
    <p>Predators: <span id="predCount">0</span></p>
    <p>Omnivores: <span id="omniCount">0</span></p>
    <button id="start">Start</button>
    <button id="stop">Stop</button>
  </div>
  <div id="status"></div>
</div>
<script>
class Cell {
  constructor() {
    this.grass = Math.random() < 0.5 ? 1 : 0;
  }
}
class Creature {
  constructor(type, x, y) {
    this.type = type; // 'herb','pred','omni'
    this.x = x; this.y = y;
    this.energy = 20;
  }
  move(world) {
    const dirs = [[1,0],[-1,0],[0,1],[0,-1]];
    const d = dirs[Math.floor(Math.random()*dirs.length)];
    this.x = Math.max(0, Math.min(world.width-1, this.x+d[0]));
    this.y = Math.max(0, Math.min(world.height-1, this.y+d[1]));
    this.energy -= 0.1; // life cost
  }
}
class World {
  constructor(w,h) {
    this.width=w; this.height=h;
    this.grid=[];
    for(let i=0;i<h;i++){this.grid.push([]); for(let j=0;j<w;j++){this.grid[i].push(new Cell());}}
    this.creatures=[];
  }
  step(growth) {
    // grow grass
    for(let row of this.grid) for(let cell of row) if(Math.random()<growth) cell.grass=1;
    // update creatures
    let newCreatures=[];
    for(let c of this.creatures){
      c.move(this);
      const cell=this.grid[c.y][c.x];
      if(c.type!='pred' && cell.grass>0){
        cell.grass=0; c.energy+=5;
        addLog(c.type+" ate grass at ("+c.x+","+c.y+")");
      }
      // check eat other
      if(c.type!='herb'){
        const prey=this.creatures.find(o=>o!=c && o.x==c.x && o.y==c.y && o.type=='herb');
        if(prey){
          prey.energy=0; c.energy+=10;
          addLog(c.type+" ate herbivore at ("+c.x+","+c.y+")");
        }
      }
      if(c.energy>40){
        c.energy/=2; newCreatures.push(new Creature(c.type,c.x,c.y));
        addLog(c.type+" reproduced at ("+c.x+","+c.y+")");
      }
      if(c.energy>0) newCreatures.push(c); else addLog(c.type+" died");
    }
    this.creatures=newCreatures;
  }
}
const canvas=document.getElementById('sim');
const ctx=canvas.getContext('2d');
const world=new World(60,40);
for(let i=0;i<10;i++) world.creatures.push(new Creature('herb',Math.floor(Math.random()*60),Math.floor(Math.random()*40)));
for(let i=0;i<5;i++) world.creatures.push(new Creature('pred',Math.floor(Math.random()*60),Math.floor(Math.random()*40)));
for(let i=0;i<5;i++) world.creatures.push(new Creature('omni',Math.floor(Math.random()*60),Math.floor(Math.random()*40)));
let running=false;
let log=[];
function addLog(msg){
  log.unshift(msg);
  if(log.length>20) log.pop();
  document.getElementById('status').innerText=log.join('\n');
}
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<world.height;y++){
    for(let x=0;x<world.width;x++){
      if(world.grid[y][x].grass) { ctx.fillStyle='green'; ctx.fillRect(x*10,y*10,10,10); }
    }
  }
  for(let c of world.creatures){
    const px=c.x*10+5, py=c.y*10+5;
    ctx.fillStyle=c.type=='herb'?'blue':c.type=='pred'?'red':'purple';
    ctx.beginPath();
    if(c.type=='herb'){
      ctx.arc(px,py,5,0,Math.PI*2);
    } else if(c.type=='pred'){
      ctx.moveTo(px,py-5); ctx.lineTo(px-5,py+5); ctx.lineTo(px+5,py+5); ctx.closePath();
    } else {
      ctx.moveTo(px,py-5); ctx.lineTo(px-5,py); ctx.lineTo(px,py+5); ctx.lineTo(px+5,py); ctx.closePath();
    }
    ctx.fill();
  }
  document.getElementById('herbCount').textContent=world.creatures.filter(c=>c.type=='herb').length;
  document.getElementById('predCount').textContent=world.creatures.filter(c=>c.type=='pred').length;
  document.getElementById('omniCount').textContent=world.creatures.filter(c=>c.type=='omni').length;
}
function loop(){
  if(running){
    world.step(parseFloat(document.getElementById('growth').value));
    draw();
    requestAnimationFrame(loop);
  }
}
document.getElementById('start').onclick=()=>{ if(!running){ running=true; addLog('Simulation started'); loop(); } };
document.getElementById('stop').onclick=()=>{ running=false; addLog('Simulation stopped'); };
draw();
addLog('Simulation ready');
</script>
</body>
</html>
